<div class="filter__dropdown filter__dropdown--city">  <div class="filter__dropdown-top">    <label for="">Lokalita</label>    <div class="filter__input-text" id="locality-input">Např.: Mladá Boleslav</div>  </div>  <div class="filter__dropdown-inside">    <div class="filter__dropdown-inside__header">      <div>Vyberte lokalitu</div>      <button class="btn btn--sm btn--icon-text filter__dropdown-inside__header--button is-button-input-search"              type="button">        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">          <path            d="M18.083 16.333h-.921l-.327-.315a7.55 7.55 0 001.832-4.935 7.583 7.583 0 10-15.167 0 7.583 7.583 0 007.583 7.584 7.55 7.55 0 004.935-1.832l.315.327v.921l5.834 5.822 1.738-1.738-5.822-5.834zm-7 0a5.243 5.243 0 01-5.25-5.25 5.243 5.243 0 015.25-5.25 5.243 5.243 0 015.25 5.25 5.243 5.243 0 01-5.25 5.25z"            fill="currentColor" />        </svg>        <b>Vyhledat dle názvu</b>      </button>      <button class="btn btn--sm btn--icon-text filter__dropdown-inside__header--button is-button-choose"              type="button" hidden>        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">          <path            d="M5.09473 13.8C5.34823 13.8 5.56248 13.7142 5.73748 13.5427C5.91248 13.3712 5.99998 13.1587 5.99998 12.9052C5.99998 12.6517 5.91423 12.4375 5.74272 12.2625C5.57123 12.0875 5.35873 12 5.10523 12C4.85173 12 4.63748 12.0857 4.46248 12.2572C4.28748 12.4287 4.19998 12.6412 4.19998 12.8947C4.19998 13.1482 4.28573 13.3625 4.45723 13.5375C4.62873 13.7125 4.84123 13.8 5.09473 13.8ZM5.09473 9.89997C5.34823 9.89997 5.56248 9.81423 5.73748 9.64272C5.91248 9.47122 5.99998 9.25873 5.99998 9.00523C5.99998 8.75173 5.91423 8.53748 5.74272 8.36247C5.57123 8.18748 5.35873 8.09998 5.10523 8.09998C4.85173 8.09998 4.63748 8.18573 4.46248 8.35723C4.28748 8.52873 4.19998 8.74123 4.19998 8.99473C4.19998 9.24823 4.28573 9.46247 4.45723 9.63748C4.62873 9.81248 4.84123 9.89997 5.09473 9.89997ZM5.09473 5.99998C5.34823 5.99998 5.56248 5.91423 5.73748 5.74273C5.91248 5.57123 5.99998 5.35873 5.99998 5.10523C5.99998 4.85173 5.91423 4.63748 5.74272 4.46248C5.57123 4.28748 5.35873 4.19998 5.10523 4.19998C4.85173 4.19998 4.63748 4.28572 4.46248 4.45722C4.28748 4.62872 4.19998 4.84122 4.19998 5.09472C4.19998 5.34822 4.28573 5.56248 4.45723 5.73748C4.62873 5.91248 4.84123 5.99998 5.09473 5.99998ZM7.79998 13.8H13.8V12H7.79998V13.8ZM7.79998 9.89997H13.8V8.09998H7.79998V9.89997ZM7.79998 5.99998H13.8V4.19998H7.79998V5.99998ZM2.39998 17.4C1.90498 17.4 1.48123 17.2237 1.12873 16.8712C0.776225 16.5187 0.599976 16.095 0.599976 15.6V2.39998C0.599976 1.90498 0.776225 1.48123 1.12873 1.12873C1.48123 0.776226 1.90498 0.599976 2.39998 0.599976H15.6C16.095 0.599976 16.5187 0.776226 16.8712 1.12873C17.2237 1.48123 17.4 1.90498 17.4 2.39998V15.6C17.4 16.095 17.2237 16.5187 16.8712 16.8712C16.5187 17.2237 16.095 17.4 15.6 17.4H2.39998ZM2.39998 15.6H15.6V2.39998H2.39998V15.6Z"            fill="currentColor" />        </svg>        <b>Vybrat ze seznamu</b>      </button>      <button class="btn btn--just-icon filter__dropdown--float-close js-property-close-btn" type="button">        <div class="icon icon--icon-times">          <svg class="icon__svg">            <use xlink:href="#icon-times"></use>          </svg>        </div>      </button>    </div>    <div class="filter__dropdown-inside__input-search" hidden>      <input name="sql[locality][locality][input]"        <?php if(isset($formData["locality"]["locality"]["input"])) { echo " value=\"{$formData["locality"]["locality"]["input"]}\" "; } ?>             class="filter__input address-autocomplete pac-input" type="text"             placeholder="Napište lokalitu, kterou hledáte nebo vyberte níže">    </div>    <div class="filter__dropdown-inside__choose">      <div class="filter__dropdown-inside-wrap">        <div class="filter__dropdown-full">          <input type="hidden" name="sql[locality][locality][city]"            <?php if(isset($formData["locality"]["locality"]["city"])) { echo " value=\"{$formData["locality"]["locality"]["city"]}\" "; } ?>>          <input type="hidden" name="sql[locality][locality][zip_code]"            <?php if(isset($formData["locality"]["locality"]["zip_code"])) { echo " value=\"{$formData["locality"]["locality"]["zip_code"]}\" "; } ?>>          <input type="hidden" name="sql[locality][locality][types]"            <?php if(isset($formData["locality"]["locality"]["types"])) { echo " value=\"{$formData["locality"]["locality"]["types"]}\" "; } ?>>          <input type="hidden" name="sql[locality][location][lat]"            <?php if(isset($formData["locality"]["location"]["lat"])) { echo " value=\"{$formData["locality"]["location"]["lat"]}\" "; } ?>>          <input type="hidden" name="sql[locality][location][lng]"            <?php if(isset($formData["locality"]["location"]["lng"])) { echo " value=\"{$formData["locality"]["location"]["lng"]}\" "; } ?>>          <input type="hidden" name="sql[locality][viewport][south]"            <?php if(isset($formData["locality"]["viewport"]["south"])) { echo " value=\"{$formData["locality"]["viewport"]["south"]}\" "; } ?>>          <input type="hidden" name="sql[locality][viewport][west]"            <?php if(isset($formData["locality"]["viewport"]["west"])) { echo " value=\"{$formData["locality"]["viewport"]["west"]}\" "; } ?>>          <input type="hidden" name="sql[locality][viewport][north]"            <?php if(isset($formData["locality"]["viewport"]["north"])) { echo " value=\"{$formData["locality"]["viewport"]["north"]}\" "; } ?>>          <input type="hidden" name="sql[locality][viewport][east]"            <?php if(isset($formData["locality"]["viewport"]["east"])) { echo " value=\"{$formData["locality"]["viewport"]["east"]}\" "; } ?>>        </div>        <div class="filter__dropdown-inside-wrap-2">          <div class="filter__dropdown-property-wrap">            <?php            $displayAll = true;            $regions = $portal->getCompanyTranslator($displayAll)->getRegions();            foreach ($regions as $regionKey => $region) { ?>              <div class="property<?php              if (isset($formData["locality_kraj_kod"]) && in_array($regionKey, $formData["locality_kraj_kod"])) {                echo " is-active";              }              ?>"                   data-region="<?php echo $regionKey; ?>">                <?php echo $region['name']; ?>                <input type="checkbox"                       name="sql[locality_kraj_kod][]"                       value="<?php echo $regionKey; ?>"                       onclick="formRegionClick(this);"                       class="form-checkbox__input city-checkbox"                  <?php if(isset($formData["locality_kraj_kod"]) && in_array($regionKey,$formData["locality_kraj_kod"])) { echo 'checked'; } ?>>              </div>            <?php } ?>          </div>          <div class="filter__dropdown-break"></div>          <?php          $displayAll = true;          $regions = $portal->getCompanyTranslator($displayAll)->getRegions();          foreach ($regions as $regionKey => $region) { ?>            <div class="filter__dropdown-checkbox-wrap is-hidden"                 data-region="<?php echo $regionKey; ?>">              <div class="filter__dropdown-region-title">                <?php echo $region['name']; ?>              </div>              <?php foreach ($region['subRegions'] as $subRegionKey => $subRegion) { ?>                <div class="form-checkbox">                  <input class="subregion locality-checkbox connect-locality-checkbox"                         name="sql[locality_okres_kod][<?php echo $regionKey; ?>][<?php echo $subRegionKey; ?>]"                         type="checkbox"                         id="checkbox<?php echo $regionKey; ?>-<?php echo $subRegionKey; ?>"                         value="<?php echo $subRegionKey; ?>"                         data-subregion-regionkey="<?php echo $regionKey; ?>"                    <?php                    if (isset($formData["locality_okres_kod"][$regionKey])                      && in_array($subRegionKey, $formData["locality_okres_kod"][$regionKey])) {                      echo 'checked';                    }                    ?>                         data-name="<?php echo $subRegion['name']; ?>">                  <span class="form-checkbox__box"></span>                  <label class="form-label"                         for="checkbox<?php echo $regionKey; ?>-<?php echo $subRegionKey; ?>">                    <?php echo $subRegion['name']; ?>                  </label>                </div>              <?php } ?>            </div>          <?php } ?>        </div>      </div>    </div>    <div class="filter__dropdown-inside__footer btn-wrap">      <button class="btn btn--sm btn--text" id="reset-filter-inside" type="button">Zadat znovu</button>      <button class="btn js-property-close-btn" type="button">Použít</button>    </div>  </div></div><style>  /* ===== LOKALITA – rozloženie panelu ===== */  @media (min-width: 1000px) {    /* panel vo vnútri modalu nech ide cez celú šírku */    .filter__dropdown--city .filter__dropdown-inside {      width: 100% !important;      max-width: none !important;    }    .filter__dropdown--city .filter__dropdown-inside__choose,    .filter__dropdown--city .filter__dropdown-inside-wrap {      width: 100%;      max-width: none;    }    /* 3 stĺpce: 1 = kraje, 2 = deliaca čiara, 3 = bloky okresov */    .filter__dropdown--city .filter__dropdown-inside-wrap-2 {      display: grid !important;      grid-template-columns: 260px 1px minmax(0, 1fr);      column-gap: 32px;      align-items: flex-start;      width: 100%;    }    /* kraje vľavo (nech si držia pôvodný vzhľad – môžu byť aj v dvoch stĺpcoch podľa globálneho CSS) */    .filter__dropdown--city .filter__dropdown-property-wrap {      grid-column: 1;    }    /* tenká vertikálna čiara */    .filter__dropdown--city .filter__dropdown-break {      grid-column: 2;      width: 1px;      height: 100%;    }    /* blok jedného kraja vpravo – cez celý pravý stĺpec */    .filter__dropdown--city .filter__dropdown-checkbox-wrap {      grid-column: 3;      width: 100% !important;      max-width: 100% !important;      margin-bottom: 16px;    }    /* viditeľný blok okresov: 3-stĺpcový grid, zalamuje sa podľa výšky */    .filter__dropdown--city .filter__dropdown-checkbox-wrap:not(.is-hidden) {      display: grid !important;      grid-template-columns: repeat(3, minmax(150px, 1fr));      column-gap: 24px;      row-gap: 6px;      align-items: flex-start;    }    /* názov kraja nad okresmi */    .filter__dropdown--city .filter__dropdown-region-title {      grid-column: 1 / -1;      margin-bottom: 6px;      font-weight: 600;    }    /* jednotlivé checkboxy okresov */    .filter__dropdown--city .filter__dropdown-checkbox-wrap .form-checkbox {      margin: 0;      padding: 2px 0;    }  }  /* skryté bloky okresov */  .filter__dropdown--city .filter__dropdown-checkbox-wrap.is-hidden {    display: none !important;  }</style><script>  document.addEventListener('DOMContentLoaded', function () {    var dropdownCity = document.querySelector('.filter__dropdown--city');    if (!dropdownCity) return;    function refreshRegionBlocks() {      var blocks = dropdownCity.querySelectorAll('.filter__dropdown-checkbox-wrap');      blocks.forEach(function (block) {        var regionId = block.getAttribute('data-region');        if (!regionId) return;        var regionCb = dropdownCity.querySelector('.city-checkbox[value="' + regionId + '"]');        if (!regionCb) return;        var property = regionCb.closest('.property');        var hasRegion = regionCb.checked;        var hasSub = block.querySelector('input.subregion:checked') !== null;        // ak sú zaškrtnuté len okresy, dorovnaj aj kraj        if (hasSub && !hasRegion) {          regionCb.checked = true;          hasRegion = true;        }        // ak kraj nemá žiadny okres, nech sa neschováva do summary        if (hasRegion || hasSub) {          if (property) property.classList.add('is-active');          block.classList.remove('is-hidden');        } else {          if (property) property.classList.remove('is-active');          block.classList.add('is-hidden');        }      });      // summary text – rátaj len konkrétne lokality (okresy)      if (typeof window.viewCheckedLocality === 'function') {        var allLocalityCheckboxes = dropdownCity.querySelectorAll('.connect-locality-checkbox');        window.viewCheckedLocality(allLocalityCheckboxes);      }    }    // globálna funkcia pre inline onclick="formRegionClick(this);"    window.formRegionClick = function (el) {      if (!el) return;      var regionId = el.value;      var block = dropdownCity.querySelector('.filter__dropdown-checkbox-wrap[data-region="' + regionId + '"]');      // keď vypíname kraj, odškrtneme aj jeho okresy      if (!el.checked && block) {        block.querySelectorAll('input.subregion').forEach(function (s) {          s.checked = false;        });      }      refreshRegionBlocks();    };    // zmena na okrese (subregion) – drž kraj zaškrtnutý, ak je aspoň jeden okres    dropdownCity.addEventListener('change', function (e) {      var target = e.target;      if (!target.classList.contains('subregion')) return;      var regionId = target.getAttribute('data-subregion-regionkey');      if (regionId) {        var regionCb = dropdownCity.querySelector('.city-checkbox[value="' + regionId + '"]');        if (regionCb && target.checked) {          regionCb.checked = true;        }      }      refreshRegionBlocks();    });    // initial state (pri načítaní formulára s už vyplnenými hodnotami)    refreshRegionBlocks();  });</script>